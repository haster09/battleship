(()=>{"use strict";const t=t=>{let e=0;return{length:t,hit:()=>e++,hitCount:()=>e,isSunk:()=>e>=t}},e=()=>{const e=[],r=()=>e,o=[],a=()=>o,s=[],c=[];return{board:o,getBoard:a,getShips:()=>{const t=[];return a().forEach((e=>{e.position.forEach((e=>{t.push(e)}))})),t},addShip:(a,s,c,i)=>{if(!("vertical"==i&&s+1<a||"horizontal"==i&&c+a>9)){let d=[];if("vertical"==i)for(let t=0;t<a;t++)d.push([s-t,c]);else if("horizontal"==i)for(let t=0;t<a;t++)d.push([s,c+t]);for(let t of d)for(let e of r())if(e.toString()==t.toString())return;const l={deck:t(a),position:d};o.push(l);for(let t of l.position)e.push([t[0]+1,t[1]-1],[t[0]+1,t[1]],[t[0]+1,t[1]+1],[t[0],t[1]-1],[t[0],t[1]],[t[0],t[1]+1],[t[0]-1,t[1]-1],[t[0]-1,t[1]],[t[0]-1,t[1]+1]);return l}},getMissed:()=>s,receiveAttack:t=>{for(let e of a())if(e.position.toString().includes(t.toString()))return c.push(t),e.deck.hit();s.push(t)},getOccupied:r,isOver:()=>{for(let t of a())if(!t.deck.isSunk())return!1;return!0},getHits:()=>c}},r=()=>({board:e(),attack:(t,e)=>{t.board.receiveAttack(e)},getRandomSquare:()=>{const t=[];for(let e=0;e<10;e++)for(let r=0;r<10;r++)t.push([e,r]);return t.splice(Math.floor(Math.random()*t.length),1)}}),o=t=>{document.querySelector("#computerBoard"),document.querySelector("#playerBoard");for(let e=9;e>=0;e--)for(let r=0;r<10;r++){const o=document.createElement("div");"computerBoard"==t.id?(o.classList.add("computerSqr"),o.dataset.computer=[e,r]):(o.classList.add("playerSqr"),o.dataset.player=[e,r]),o.classList.add("sqr"),t.appendChild(o)}},a=t=>{const e=t=>Math.floor(Math.random()*t),r=[2,3,4,4,5];for(;t.getBoard().length<5;)t.addShip(r[r.length-1],e(9),e(9),1==Math.floor(2*Math.random())?"horizontal":"vertical")&&r.pop()},s=r(),c=r();a(c.board),a(s.board),o(playerBoard),o(computerBoard),((t,e)=>{const r=document.querySelectorAll(".playerSqr"),o=document.querySelectorAll(".computerSqr");r.forEach((e=>{for(let r of t)r==e.dataset.player&&e.classList.add("playerShip")})),o.forEach((t=>{for(let r of e)r==t.dataset.computer&&t.classList.add("computerShip")}))})(s.board.getShips(),c.board.getShips()),document.querySelectorAll(".computerSqr").forEach((t=>{t.addEventListener("click",(t=>{s.attack(c,[t.target.dataset.computer[0],t.target.dataset.computer[2]]),c.attack(s,s.getRandomSquare()),((t,e,r,o)=>{const a=document.querySelectorAll(".playerSqr"),s=document.querySelectorAll(".computerSqr");a.forEach((r=>{t.forEach((t=>{t!=r.dataset.player||r.classList.contains("hitComputer")||r.classList.add("missComputer")})),e.forEach((t=>{t!=r.dataset.player||r.classList.contains("missComputer")||r.classList.add("hitComputer")}))})),s.forEach((t=>{r.forEach((e=>{e!=t.dataset.computer||t.classList.contains("hit")||t.classList.add("miss")})),o.forEach((e=>{e!=t.dataset.computer||t.classList.contains("miss")||t.classList.add("hit")}))}))})(s.board.getMissed(),s.board.getHits(),c.board.getMissed(),c.board.getHits())}))}))})();